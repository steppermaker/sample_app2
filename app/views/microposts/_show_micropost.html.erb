<li id="micropost-<%= micropost.id %>" >
  <%= link_to gravatar_for(micropost.user, size: 50), micropost.user %>
  <span class="shrink_letters">
    <span class="user"><%= link_to micropost.user.name, micropost.user %></span>
    <span class="unique_name">@<%= micropost.user.unique_name %></span>
  </span>
  <span class="timestamp">·
    <% if micropost.created_at < 1.years.ago %>
      <%= micropost.created_at.strftime("%-Y年-%-m月-%d日") %>
    <% elsif micropost.created_at < 1.days.ago %>
      <%= micropost.created_at.strftime("%-m月%-d日") %>
    <% else %>
      <%= micropost.created_at.strftime("%H:%M") %>
    <% end %>
  </span>

  <%= link_to(micropost, class: "no_decoration") do %>
    <span class="show_content">
      <%= micropost.content %>
      <%= image_tag micropost.picture.url if micropost.picture? %>
    </span>
  <% end %>

  <div class="show_micropost_status">
    <span class="counts">
      <%= link_to likes_micropost_path(micropost) do %>
        <b><%= micropost.likes_count %></b> likes
      <% end %>
    </span>
    <span class="counts">
      <b><%= micropost.replies_count %></b> replies
    </span>
  </div>

  <span class="like">
    <% if logged_in? && micropost.likes.find_by(user_id: current_user.id) %>
      <%= form_for(micropost.likes.find_by(user_id: current_user.id), method: :delete, remote: true) do |f| %>
        <%= button_tag(class: "btn btn-default btn-xs unlike_btn like_btns") do %>
          <%= content_tag :i, "", class: "glyphicon glyphicon-heart"  %>
          <%= content_tag :span, "#{micropost.likes_count}", class: "likes_count" %>
        <% end %>
      <% end %>
    <% else %>
      <%= form_for(micropost.likes.build, remote: true) do |f| %>
        <div><%= hidden_field_tag :micropost_id, micropost.id %></div>
        <%= button_tag(class: "btn btn-default btn-xs like_btn like_btns
                              #{'login_required' unless logged_in?}",
                              data: { btn: 'like' }) do %>
          <%= content_tag :i, "", class: "glyphicon glyphicon-heart-empty",
                                  aria: { hidden: true } %>
          <%= content_tag :span, "#{micropost.likes_count}", class: "likes_count" %>
        <% end %>
      <% end %>
    <% end %>
  </span>
  <span class="reply">
    <%= button_tag(class: "btn btn-default btn-xs reply_btn
                          #{'login_required' unless logged_in?}",
                          data: { btn: 'reply' }) do %>
      <%= content_tag :i , "", class: "glyphicon glyphicon-comment",
                               aria: { hidden: true } %>
      <%= content_tag :sapn, "#{micropost.replies_count}" %>
    <% end %>
  </span>
  <span class="edit_micropost">
    <% if current_user?(micropost.user) %>

      <%= button_tag(class: "btn btn-default btn-xs edit_btn") do %>
        <%= content_tag :i, "", class: "glyphicon glyphicon-edit" %>
      <% end %>
      <div class="edit_micropost_screen">
        <%= form_for(micropost, method: :delete) do |f| %>
          <%= button_tag(class: "btn  btn-xs" ) do %>
            <%= content_tag :i, "", class: "glyphicon glyphicon-trash",
                                    aria: { hidden: true } %>
            <%= content_tag :span, "delete" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </span>
  <div class="reply_form">
    <% if logged_in? %>
      <%= button_tag "x", class: "close_reply_form" %>
      <%= form_for(current_user.microposts.build) do |f| %>
        <%= hidden_field_tag :destination_id, micropost.id %>
        <%= f.text_area :content, placeholder: "Compose for reply...",
                                  class: "reply_text_area"%>
        <div class="flex-reply-from">
          <span class="picture reply_picture">
            <%= f.file_field :picture, accept: 'image/jpeg,image/gif,image/png' %>
          </span>
          <span>
            <%= f.submit "Reply", class: "btn btn-primary reply_form_button" %>
          </span>
        </div>
      <% end %>
    <% end %>
  </div>
</li>
